<!DOCTYPE html>
<html class="w-full h-full m-0 p-0">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
    <script>
        $(document).ready(function () {
            $('.menu').empty();
            const btns = [1, 2, 3, 4].map(e => {
                return $('<button>').addClass('shadow-lg border rounded-lg bg-white p-2').text(`${e}세대`);
            });
            btns.forEach(e => {
                e.click(function () {
                    query(keys[0], `select * where A = ${e}`, 'my_callback');
                });
                e.appendTo('.menu');
            });
        });
        const API_KEY = 'AIzaSyBFYYQSF1a146Ipy2cPnnRxWUNXT1fKimk';
        const SPREADSHEET_DOC_ID = "1NzINHRoGNq53OGnuo99wcd8bkNFMAizz7qN8Hj_Rxlk"
        const GOOGLE_SERVICE_ACCOUNT_EMAIL = "admin-595@vote-idol-440117.iam.gserviceaccount.com"
        const GOOGLE_PRIVATE_KEY = "-----BEGIN PRIVATE KEY-----\nMIIEvQIBADANBgkqhkiG9w0BAQEFAASCBKcwggSjAgEAAoIBAQDTCTsCM7gN+Nte\nOm+/GjxPU5vMrj8qfuvtS+tsIAlM3d7FHlRgm74UG+H4tXe7div8DOFLlPR8YNzz\nWH+Mgrr8guFJZPK5W9a5CQPMkFTDifIVoj93Wevl0KiElRO2lARTPtWm3/Yuc8S4\n5OU96Q+/1Ujr0KWJkEKw5lb8sLrLa211CnnWUcrXPbte+QjIF7EgU4WZjdixLljz\nR93vAHDJMyp83pY80Q7UJWwXJ8y+j2OsM5SicKlRPndRzSX9D/YUHi37NOS9P5pq\n0zIzmnY6getHAgzkxOm4peNIvlcimHsW1Uqm9EqlEc54cocDZNyaWk7ZbvFvDj/h\nniNiHVGvAgMBAAECggEACjipHo+EfxNqIe47h8pzvAPcOpzHtDZTTh2skWZUt6cK\n8HvcBs5LZ2+12GbcVqAOLcRnRRnkgR4lQCefYlbZvPvkgQ/BvIUHGyneZFkrCPSf\nQJz90Jy5dncyFd1mJF1Bm+2wEMe7voYCQhlpYQcn4ljvkecKD0lo/7v9pwhr2Qj+\nQNfVg5hDHqxJZAI4mmsuudUJ9TAkEWmSqqQXyzr4aIIS+9ejmemlFLeFuHmyPnfg\nIHG04V1HiAJJTJFE5hXdZc5oiPbsX6rRMdJ2L9P8MQOS+Lt1gJQe2t1eHmzt7HM3\n61VkvzY85eBSmuivwB2hL8aalaW6VeX0WIKZtkN0AQKBgQDqfODJRokvQb1lQDvK\n9NbxLsBx8CeCtV6JdbZ+039ccy1H7PIYh2inBsFfixvQA+zXpVEpKhxsSMb5iWzQ\nuXGo88v5YEbOhwry+7+VQPVbCp16872dmLEaZWpu3/3yAfNLBoiwwqIzHNItIbN7\nKBpqN+5mIhcht7dDW8xD+LUp7wKBgQDmZZIOsvJvJrf2LUmYIxhwrodfZn0IE4QQ\nrI1gKmhXFZb85YYFbvHp5+cdQCz1sLbgYOu9cv5IgcK7BonLUM0eqagB1BwJ7Fwo\nGWaOWo/G+tyXDFm5q8tOgseZKpEWlsSFj8Nh9jeYGLXOUFDKMmOBJYDLjfQYC1Xf\nnNhcS5kUQQKBgEIZVZwnQACMPYFPLAu4HOb70M/NbLXRvoZtIjZ6FArRhNAjoNL9\nSKjcpKH0KrDmilr3hPtfnYeAtGYfMQddXwbLQpJXa15IfvOjt4uxNfil82J3VtoX\n8sSIFgqPJZyUpCpf+yQomWRjGXQTbe6njVqnzZIIxhCBIy3fsKLwdtENAoGAHvNe\nH6NidhQZenSzAkEUs25+uQ4nlcIpZ6QGifioc6pu0iJzUp+I2AdTQNayM3890f6z\nLIwaJNtpsX47XJjKNWhNLZG1ApBCAREIee8oiW6B27jJBOxTL4TaE3VocERouhiK\nAsr0xPXs1n5rm/4Q5/SFzNKRC/nZ22RSnHN7aQECgYEAk+QnijQxGlwVLwz8Ap9p\nrdBd0QdeHD9NargMV37XmOK7WVoiNsCEsc3dtMYrJPuPaci73sgmyjgsJQgoq7qu\ndExdQ2X6W7KnoCEEm2Bq8yKcN2iC74I2+i/9Ckj4SbO2uFsUHjNBvRZyzyCH3zs0\nyqk9fsh1p48ehftZn2NyrW8=\n-----END PRIVATE KEY-----\n";
        async function start() {
            $.getJSON(`https://sheets.googleapis.com/v4/spreadsheets/${SPREADSHEET_DOC_ID}/values/그룹!A1:Z100?key=${API_KEY}`,
                function (data) {
                    const res = data.values;
                    const col = res[0];
                    var data = res.slice(1);
                    data = data.map(e => {
                        const o = {};
                        col.forEach((c, i) => {
                            o[c] = e[i];
                        });
                        return o;
                    });
                    $('.tiles').empty();
                    data.forEach(e => {
                        const tile = $('<div>')
                            .addClass('shadow-lg border rounded-lg bg-white p-2 cursor-pointer hover:bg-gray-100')
                            .html(
                                Object.keys(e).map(k => {
                                    return `<div>${k}: ${e[k]}</div>`;
                                }).join('')
                            )
                            .click(async function () {
                                const ip = await getIp();
                                const url = `https://sheets.googleapis.com/v4/spreadsheets/${SPREADSHEET_DOC_ID}/values/투표!A1:Z100?key=${API_KEY}`;
                                console.log(ip, url);
                                $.ajax({
                                    // POST https://sheets.googleapis.com/v4/spreadsheets/{spreadsheetId}/values/{range}:append
                                    url: `https://sheets.googleapis.com/v4/spreadsheets/${SPREADSHEET_DOC_ID}/values/투표!A1:Z100:append?key=${API_KEY}`,
                                    type: 'POST',
                                    data: JSON.stringify({
                                        ip,
                                        group: e['그룹명'],
                                        // member: e['이름'],
                                    }),
                                    success: function (data) {
                                        console.log(data);
                                    },
                                    error: function (err) {
                                        console.log(err.responseText);
                                    },
                                });
                            });
                        tile.appendTo('.tiles');
                    });
                });
            // gapi.client.init({
            //     apiKey: API_KEY,
            //     discoveryDocs: ['https://sheets.googleapis.com/$discovery/rest?version=v4'],
            // }).then(() => {
            //     gapi.client.sheets.spreadsheets.values.get({
            //         spreadsheetId: SPREADSHEET_DOC_ID,
            //         range: '그룹!A1:Z100',
            //     })
            //         .then((res) => {
            //             res = res.result.values;
            //             const col = res[0];
            //             var data = res.slice(1);
            //             data = data.map(e => {
            //                 const o = {};
            //                 col.forEach((c, i) => {
            //                     o[c] = e[i];
            //                 });
            //                 return o;
            //             });
            //             console.log(data);
            //         }).catch((err) => {
            //             console.log(err);
            //         });
            //     gapi.client.sheets.spreadsheets.values.update();
            // });
        }
        function gapiLoaded() {
            gapi.load('client', start);
        }
        function getIp() {
            return new Promise((resolve, reject) => {
                $.getJSON('https://jsonip.com', function (data) {
                    resolve(data.ip);
                });
            });
        }
    </script>
    <script async defer src="https://apis.google.com/js/api.js" onload="gapiLoaded()"></script>
</head>

<body class="w-full h-full m-0 p-0">
    <div class="flex flex-wrap menu gap-1 p-3">
    </div>
    <div class="flex flex-wrap gap-1 p-3 tiles">
    </div>
    <table></table>
</body>

</html>